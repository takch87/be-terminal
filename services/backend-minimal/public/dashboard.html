<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeTerminal Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8em;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9em;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .navigation {
            background: #f8f9fa;
            padding: 0;
            border-bottom: 1px solid #e9ecef;
            overflow-x: auto;
        }

        .nav-container {
            display: flex;
            min-width: 600px;
        }

        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            color: #6c757d;
            font-weight: 500;
        }

        .nav-item:hover,
        .nav-item.active {
            background: white;
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .content {
            padding: 30px;
            min-height: calc(100vh - 140px);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.95em;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            margin-bottom: 20px;
        }

        .card h3 {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.3em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .transaction-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .status-success { border-left-color: #28a745; }
        .status-failed { border-left-color: #dc3545; }
        .status-pending { border-left-color: #ffc107; }

        .download-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .download-item:hover {
            background: #e9ecef;
        }

        .download-item h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .download-item p {
            color: #6c757d;
            margin-bottom: 15px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .processor-config {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .processor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .processor-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä BeTerminal Dashboard</h1>
            <div class="user-info">
                <div class="user-avatar">üë§</div>
                <span id="username">Admin</span>
                <a href="/login.html" class="logout-btn">üö™ Cerrar Sesi√≥n</a>
            </div>
        </div>

        <div class="navigation">
            <div class="nav-container">
                <div class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
                <div class="nav-item" onclick="showSection('users')">üë• Usuarios</div>
                <div class="nav-item" onclick="showSection('events')">üé´ Eventos</div>
                <div class="nav-item" onclick="showSection('transactions')">üí≥ Transacciones</div>
                <div class="nav-item" onclick="showSection('downloads')">üì± Descargas</div>
                <div class="nav-item" onclick="showSection('payments')">‚öôÔ∏è Payment Config</div>
                <div class="nav-item" onclick="showSection('system')">üîß Sistema</div>
            </div>
        </div>

        <div class="content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="section active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-transactions">-</div>
                        <div class="stat-label">Transacciones Totales</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-amount">-</div>
                        <div class="stat-label">Monto Total ($)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="successful-transactions">-</div>
                        <div class="stat-label">Exitosas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="failed-transactions">-</div>
                        <div class="stat-label">Fallidas</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìã Transacciones Recientes</h3>
                    <button class="btn" onclick="loadDashboard()">üîÑ Actualizar</button>
                    <div id="transactions-container" style="margin-top: 20px;">‚è≥ Cargando...</div>
                </div>
            </div>

            <!-- Users Section -->
            <div id="users" class="section">
                <div class="card">
                    <h3>üë• Gesti√≥n de Usuarios</h3>
                    <button class="btn" onclick="loadUsers()">üîÑ Actualizar</button>
                    <div id="users-container" style="margin-top: 20px;">‚è≥ Cargando usuarios...</div>
                </div>
            </div>

            <!-- Events Section -->
            <div id="events" class="section">
                <div class="card">
                    <h3>üé´ Gesti√≥n de Eventos</h3>
                    <button class="btn" onclick="loadEvents()">üîÑ Actualizar</button>
                    <div id="events-container" style="margin-top: 20px;">‚è≥ Cargando eventos...</div>
                </div>
            </div>

            <!-- Transactions Section -->
            <div id="transactions" class="section">
                <div class="card">
                    <h3>üí≥ Historial de Transacciones</h3>
                    <div id="all-transactions-container">‚è≥ Cargando transacciones...</div>
                </div>
            </div>

            <!-- Downloads Section -->
            <div id="downloads" class="section">
                <div class="card">
                    <h3>üì± Descargas de Aplicaciones</h3>
                    
                    <div class="download-item">
                        <h4>ü§ñ BeTerminal Android (Minimal)</h4>
                        <p>Aplicaci√≥n Android simplificada para procesamiento de pagos</p>
                        <a href="/downloads/betTerminal-minimal.apk" class="btn" download>‚¨áÔ∏è Descargar APK</a>
                    </div>

                    <div class="download-item">
                        <h4>ü§ñ BeTerminal Android (Full)</h4>
                        <p>Aplicaci√≥n Android completa con todas las funcionalidades</p>
                        <a href="/downloads/betTerminal-full.apk" class="btn" download>‚¨áÔ∏è Descargar APK</a>
                    </div>

                    <div class="download-item">
                        <h4>üíª Script de Cliente Linux</h4>
                        <p>Script para automatizar la descarga e instalaci√≥n del cliente</p>
                        <a href="/downloads/betTerminal-client.sh" class="btn" download>‚¨áÔ∏è Descargar Script</a>
                    </div>
                </div>
            </div>

            <!-- Payment Config Section -->
            <div id="payments" class="section">
                <div class="card">
                    <h3>‚öôÔ∏è Configuraci√≥n de Procesadores de Pago</h3>
                    
                    <div class="tabs">
                        <div class="tab active" onclick="showPaymentTab('processors')">üè¶ Procesadores</div>
                        <div class="tab" onclick="showPaymentTab('stripe')">üí≥ Stripe</div>
                        
                    </div>

                    <!-- Processors Overview Tab -->
                    <div id="processors-tab" class="tab-content active">
                        <div id="processors-list">‚è≥ Cargando procesadores...</div>
                        <button class="btn" onclick="loadProcessors()">üîÑ Actualizar</button>
                    </div>

                    <!-- Stripe Configuration Tab -->
                    <div id="stripe-tab" class="tab-content">
                        <div class="processor-config">
                            <div class="processor-header">
                                <h4>üí≥ Configuraci√≥n de Stripe</h4>
                                <span id="stripe-status" class="processor-status status-inactive">Inactivo</span>
                            </div>
                            
                            <form id="stripe-form">
                                <div class="form-group">
                                    <label>Publishable Key:</label>
                                    <input type="text" id="stripe-publishable-key" placeholder="pk_test_..." required>
                                </div>
                                <div class="form-group">
                                    <label>Secret Key:</label>
                                    <input type="password" id="stripe-secret-key" placeholder="sk_test_..." required>
                                </div>
                                <div class="form-group">
                                    <label>Webhook Secret:</label>
                                    <input type="password" id="stripe-webhook-secret" placeholder="whsec_...">
                                </div>
                                <div class="form-group">
                                    <label>Entorno:</label>
                                    <select id="stripe-environment">
                                        <option value="test">Test</option>
                                        <option value="live">Producci√≥n</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn">üíæ Guardar Configuraci√≥n</button>
                                <button type="button" class="btn btn-secondary" onclick="testStripeConnection()">üîç Probar Conexi√≥n</button>
                            </form>
                        </div>
                    </div>

                    

                    <div id="payment-message" class="alert" style="display:none;"></div>
                </div>
            </div>

            <!-- System Section -->
            <div id="system" class="section">
                <div class="card">
                    <h3>üîß Informaci√≥n del Sistema</h3>
                    <div id="system-info">‚è≥ Cargando informaci√≥n del sistema...</div>
                    <button class="btn" onclick="loadSystemInfo()">üîÑ Actualizar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked nav item
            event.target.classList.add('active');
            
            // Load section-specific data
            if (sectionId === 'dashboard') {
                loadDashboard();
            } else if (sectionId === 'users') {
                loadUsers();
            } else if (sectionId === 'events') {
                loadEvents();
            } else if (sectionId === 'transactions') {
                loadAllTransactions();
            } else if (sectionId === 'payments') {
                loadProcessors();
            } else if (sectionId === 'system') {
                loadSystemInfo();
            }
        }

        // Helper function for authenticated requests
        async function authenticatedFetch(url, options = {}) {
            // For now, we'll make requests without explicit auth tokens
            // since the session should handle authentication
            const defaultOptions = {
                credentials: 'same-origin',
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                }
            };
            
            const finalOptions = { ...defaultOptions, ...options };
            
            try {
                const response = await fetch(url, finalOptions);
                
                if (response.status === 401) {
                    // Redirect to login if unauthorized
                    window.location.href = '/login.html';
                    return null;
                }
                
                return response;
            } catch (error) {
                console.error('Request failed:', error);
                throw error;
            }
        }

        function showPaymentTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId + '-tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load tab-specific data
            if (tabId === 'processors') {
                loadProcessors();
            } else if (tabId === 'stripe') {
                loadStripeConfig();
            }
        }

        // Dashboard functions
        async function loadDashboard() {
            try {
                const statsResponse = await fetch('/api/dashboard/stats');
                const stats = await statsResponse.json();
                
                document.getElementById('total-transactions').textContent = stats.totalTransactions || 0;
                document.getElementById('total-amount').textContent = (stats.totalAmount || 0) / 100;
                document.getElementById('successful-transactions').textContent = stats.successfulTransactions || 0;
                document.getElementById('failed-transactions').textContent = stats.failedTransactions || 0;
                
                const transactionsResponse = await fetch('/api/dashboard/transactions');
                const transactions = await transactionsResponse.json();
                
                const container = document.getElementById('transactions-container');
                if (transactions.length > 0) {
                    container.innerHTML = transactions.map(tx => `
                        <div class="transaction-item status-${tx.status}">
                            <strong>${tx.transaction_id}</strong> - $${(tx.amount/100).toFixed(2)} - ${tx.status}
                            <br><small>${new Date(tx.created_at).toLocaleString()}</small>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p>üì≠ No hay transacciones recientes</p>';
                }
                    
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('transactions-container').innerHTML = '<p>‚ùå Error cargando datos</p>';
            }
        }

        async function loadAllTransactions() {
            try {
                const response = await fetch('/api/dashboard/transactions?limit=50');
                const transactions = await response.json();
                
                const container = document.getElementById('all-transactions-container');
                if (transactions.length > 0) {
                    container.innerHTML = transactions.map(tx => `
                        <div class="transaction-item status-${tx.status}">
                            <strong>${tx.transaction_id}</strong> - $${(tx.amount/100).toFixed(2)} - ${tx.status}
                            <br><small>${new Date(tx.created_at).toLocaleString()}</small>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p>üì≠ No hay transacciones</p>';
                }
                    
            } catch (error) {
                console.error('Error loading transactions:', error);
                document.getElementById('all-transactions-container').innerHTML = '<p>‚ùå Error cargando transacciones</p>';
            }
        }

        async function loadUsers() {
            try {
                const response = await fetch('/api/dashboard/users');
                const users = await response.json();
                
                const container = document.getElementById('users-container');
                if (users.length > 0) {
                    container.innerHTML = users.map(user => `
                        <div class="transaction-item">
                            <strong>üë§ ${user.username}</strong>
                            <br><small>Creado: ${new Date(user.created_at).toLocaleString()}</small>
                            <br><small>√öltimo acceso: ${user.last_login ? new Date(user.last_login).toLocaleString() : 'Nunca'}</small>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p>üë• No hay usuarios registrados</p>';
                }
                    
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('users-container').innerHTML = '<p>‚ùå Error cargando usuarios</p>';
            }
        }

        async function loadEvents() {
            try {
                const response = await fetch('/api/dashboard/events');
                const events = await response.json();
                
                const container = document.getElementById('events-container');
                if (events.length > 0) {
                    container.innerHTML = events.map(event => `
                        <div class="transaction-item">
                            <strong>üé´ ${event.event_name || event.code}</strong>
                            <br><small>C√≥digo: ${event.code}</small>
                            <br><small>Cantidad: $${(event.amount/100).toFixed(2)}</small>
                            <br><small>Creado: ${new Date(event.created_at).toLocaleString()}</small>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p>üé´ No hay eventos configurados</p>';
                }
                    
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('events-container').innerHTML = '<p>‚ùå Error cargando eventos</p>';
            }
        }

        // Payment processor functions
        async function loadProcessors() {
            try {
                const response = await authenticatedFetch('/api/payment/processors');
                if (!response) return;
                
                const data = await response.json();
                const list = Array.isArray(data) ? data : (data.processors || []);
                const stripeOnly = list.filter(p => p.name === 'stripe');
                const container = document.getElementById('processors-list');
                if (stripeOnly.length === 0) {
                    container.innerHTML = '<p>Sin procesadores activos</p>';
                    return;
                }
                container.innerHTML = stripeOnly.map(processor => `
                    <div class="processor-config">
                        <div class="processor-header">
                            <h4>üí≥ Stripe</h4>
                            <span class="processor-status ${processor.enabled ? 'status-active' : 'status-inactive'}">
                                ${processor.enabled ? 'Activo' : 'Inactivo'}
                            </span>
                        </div>
                        <p>Entorno: ${processor.environment || 'test'}</p>
                        <p>Configurado: ${processor.is_configured ? 'S√≠' : 'No'}</p>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading processors:', error);
                document.getElementById('processors-list').innerHTML = '<p>‚ùå Error cargando procesadores</p>';
            }
        }

        async function loadStripeConfig() {
            try {
                const response = await authenticatedFetch('/api/payment/config/stripe');
                if (!response) return;
                
                const config = await response.json();
                
                if (config.publishable_key) {
                    document.getElementById('stripe-publishable-key').value = config.publishable_key;
                    document.getElementById('stripe-environment').value = config.environment || 'test';
                    document.getElementById('stripe-status').textContent = 'Configurado';
                    document.getElementById('stripe-status').className = 'processor-status status-active';
                }
                
            } catch (error) {
                console.error('Error loading Stripe config:', error);
            }
        }

        

        // Form handlers
        document.getElementById('stripe-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const config = {
                publishable_key: document.getElementById('stripe-publishable-key').value,
                secret_key: document.getElementById('stripe-secret-key').value,
                webhook_secret: document.getElementById('stripe-webhook-secret').value,
                environment: document.getElementById('stripe-environment').value
            };
            
            try {
                const response = await authenticatedFetch('/api/payment/config/stripe', {
                    method: 'POST',
                    body: JSON.stringify(config)
                });
                
                if (!response) return;
                
                const result = await response.json();
                showPaymentMessage(result.success ? 'success' : 'error', result.message || 'Configuraci√≥n guardada');
                
                if (result.success) {
                    loadStripeConfig();
                    loadProcessors();
                }
                
            } catch (error) {
                showPaymentMessage('error', 'Error guardando configuraci√≥n de Stripe');
            }
        });

        

        async function testStripeConnection() {
            try {
                const response = await authenticatedFetch('/api/stripe/test-connection');
                if (!response) return;
                
                const result = await response.json();
                showPaymentMessage(result.success ? 'success' : 'error', result.message);
            } catch (error) {
                showPaymentMessage('error', 'Error probando conexi√≥n con Stripe');
            }
        }

        

        function showPaymentMessage(type, message) {
            const messageDiv = document.getElementById('payment-message');
            messageDiv.className = `alert alert-${type === 'success' ? 'success' : 'error'}`;
            messageDiv.textContent = message;
            messageDiv.style.display = 'block';
            
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        async function loadSystemInfo() {
            try {
                const response = await fetch('/api/system/info');
                const info = await response.json();
                
                document.getElementById('system-info').innerHTML = `
                    <p><strong>Servidor:</strong> ${info.server || 'N/A'}</p>
                    <p><strong>Versi√≥n:</strong> ${info.version || 'N/A'}</p>
                    <p><strong>Uptime:</strong> ${info.uptime || 'N/A'}</p>
                    <p><strong>Base de Datos:</strong> ${info.database || 'SQLite'}</p>
                `;
                
            } catch (error) {
                console.error('Error loading system info:', error);
                document.getElementById('system-info').innerHTML = '<p>‚ùå Error cargando informaci√≥n del sistema</p>';
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
        });
    </script>
</body>
</html>
<- be-seamless-v2.0.0-debug.apk ( Initial Rebrand ) Version: 1757554824 -->
